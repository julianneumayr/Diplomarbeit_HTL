import os
import tempfile

from PIL import Image, ImageDraw, ImageFont
from settings import PI, PRINT_LABEL_PATH


def print_label(business_order, article_number, number, quantity, user):
    if PI:
        with tempfile.NamedTemporaryFile(suffix=".png", delete=False) as temp_file:
            temp_filename = temp_file.name
            # define texts and positions
            text1 = business_order
            position1 = (30, 10)
            text2 = f"{str(number).zfill(4)} / {str(quantity).zfill(4)}"
            position2 = (490, 10)
            text3 = article_number
            position3 = (30, 390)
            text4 = user
            position4 = (660, 390)

            # Lade das Bild
            image = Image.open(f"{PRINT_LABEL_PATH}/vorlage.png")

            # Erstelle ein Zeichen-Objekt
            draw = ImageDraw.Draw(image)

            # Lade eine Schriftart
            font = ImageFont.truetype("arial.ttf", size=70)  # Pfade zur Schriftart ersetzen

            # Schreibe den Text auf das Bild
            draw.text(position1, text1, font=font, fill=(0, 0, 0))  # RGB-Farbe
            draw.text(position2, text2, font=font, fill=(0, 0, 0))  # RGB-Farbe
            draw.text(position3, text3, font=font, fill=(0, 0, 0))  # RGB-Farbe
            draw.text(position4, text4, font=font, fill=(0, 0, 0))  # RGB-Farbe

            # Speichere das bearbeitete Bild
            image.save(temp_filename)

            # Drucke das Bild
            os.system(f"lp -d cab_SQUIX_4_300P {temp_filename}")
