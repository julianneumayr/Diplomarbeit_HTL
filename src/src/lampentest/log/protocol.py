import os
import csv
import datetime
from PyQt5.QtCore import QSettings

class Protocol:
    def __init__(self):
        self.settings = QSettings("Bilton","Lampentest")

    def save_test_data(self, user, business_order, article_number, number, quantity):
        file_path = self.settings.value("filepath")+"/protokoll.csv"
        # Check if the file already exists, and create it if it doesn't
        file_exists = os.path.exists(file_path)

        with open(file_path, mode="a", newline="") as file:
            fieldnames = ["Date", "Time", "User", "Business Order", "Article Number", "Tool", "Number", "Quantity"]
            delimiter = ";"
            writer = csv.DictWriter(file, fieldnames=fieldnames, delimiter=delimiter)

            if not file_exists:
                writer.writeheader()

            writer.writerow(
                {
                    "Date": datetime.datetime.now().strftime("%d.%m.%Y"),
                    "Time": datetime.datetime.now().strftime("%H:%M:%S"),
                    "User": user,
                    "Business Order": business_order,
                    "Article Number": article_number,
                    "Tool": self.settings.value("current_tool"),
                    "Number": number,
                    "Quantity": quantity,
                }
            )

    def save_tool_change(self, user, old_tool, new_tool):
        file_path = self.settings.value("filepath")+"/werkzeugwechsel.csv"
        # Check if the file already exists, and create it if it doesn't
        file_exists = os.path.exists(file_path)

        with open(file_path, mode="a", newline="") as file:
            fieldnames = ["Date", "Time", "User", "Old Tool", "New Tool"]
            delimiter = ";"
            writer = csv.DictWriter(file, fieldnames=fieldnames, delimiter=delimiter)

            if not file_exists:
                writer.writeheader()

            writer.writerow(
                {
                    "Date": datetime.datetime.now().strftime("%d.%m.%Y"),
                    "Time": datetime.datetime.now().strftime("%H:%M:%S"),
                    "User": user,
                    "Old Tool": old_tool,
                    "New Tool": new_tool,
                }
            )

        self.settings.setValue("current_tool", new_tool)        
        
        

